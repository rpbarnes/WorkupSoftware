\NeedsTeXFormat{LaTeX2e}[1994/12/01]
\DeclareOption{supressmulticols}{\newcommand{\supressmulticols}{test}}
\DeclareOption{nomulticols}{\newcommand{\supressmulticols}{test}}
\DeclareOption{showscriptnumber}{\newcommand{\showscriptnumber}{test}}
\DeclareOption{nolabels}{\newcommand{\nolabels}{test}}
\DeclareOption{noparagraph}{\newcommand{\noparagraph}{test}}
\DeclareOption{nopageformat}{\newcommand{\nopageformat}{test}}
\DeclareOption{noheader}{\newcommand{\noheader}{test}}
\ProcessOptions
\RequirePackage{myhyperref}
\RequirePackage{mypython}
\RequirePackage{mycolors}
\RequirePackage{mydefs}
\RequirePackage{mybasiccomments}
%{{{ symbols
\RequirePackage{bbold} %for mathbb
\RequirePackage{subfigure} %for mathbb
\RequirePackage{pifont}
\RequirePackage{cancel}
\RequirePackage{xspace}
\RequirePackage[electronic]{ifsym}
%}}}
\RequirePackage{fancyhdr}
\RequirePackage{wrapfig}
\RequirePackage[procnames]{listings}
\RequirePackage{setspace}
\RequirePackage[justification=centerlast,font=small]{caption}% this provides the \newline command within captions
%\RequirePackage{minted}
\RequirePackage{palatino}
\RequirePackage{amsfonts}
\RequirePackage{url}
\RequirePackage{array}
\RequirePackage{lettrine} % large initial caps
%\RequirePackage{cleveref} % cref -- which does references like citations
%{{{ original listings code -- not great
%\lstset{frame=none,
%  showtabs=False,
%  showspaces=False,
%  showstringspaces=False,
%  commentstyle={\ttfamily\color{dgraycolor}},
%  keywordstyle={\ttfamily\color{blue}\bfseries},
%  stringstyle={\ttfamily\color{dgreencolor}\bfseries},
%  language=Python,
%  basicstyle={\fontsize{7pt}{7pt}\ttfamily},
%  aboveskip=0.3em,
%  belowskip=0.1em,
%  numbers=left,
%  numberstyle={\fontsize{5pt}{5pt}\ttfamily}}
%}}}
%{{{ new listings code
\lstset{
language=python,
basicstyle=\footnotesize\ttfamily\renewcommand{\baselinestretch}{0.7},
stringstyle=\color{dgreencolor},
showstringspaces=false,
alsoletter={1234567890},
otherkeywords={\ , \}, \{},
keywordstyle=\color{blue},
emph={access,and,as,break,class,continue,def,del,elif,else,%
except,exec,finally,for,from,global,if,import,in,is,%
lambda,not,or,pass,print,raise,return,try,while,assert},
emphstyle=\color{dbluecolor}\bfseries,
emph={[2]self},
emphstyle=[2]\color{gray},
emph={[4]ArithmeticError,AssertionError,AttributeError,BaseException,%
DeprecationWarning,EOFError,Ellipsis,EnvironmentError,Exception,%
False,FloatingPointError,FutureWarning,GeneratorExit,IOError,%
ImportError,ImportWarning,IndentationError,IndexError,KeyError,%
KeyboardInterrupt,LookupError,MemoryError,NameError,None,%
NotImplemented,NotImplementedError,OSError,OverflowError,%
PendingDeprecationWarning,ReferenceError,RuntimeError,RuntimeWarning,%
StandardError,StopIteration,SyntaxError,SyntaxWarning,SystemError,%
SystemExit,TabError,True,TypeError,UnboundLocalError,UnicodeDecodeError,%
UnicodeEncodeError,UnicodeError,UnicodeTranslateError,UnicodeWarning,%
UserWarning,ValueError,Warning,ZeroDivisionError,abs,all,any,apply,%
basestring,bool,buffer,callable,chr,classmethod,cmp,coerce,compile,%
complex,copyright,credits,delattr,dict,dir,divmod,enumerate,eval,%
execfile,exit,file,filter,float,frozenset,getattr,globals,hasattr,%
hash,help,hex,id,input,int,intern,isinstance,issubclass,iter,len,%
license,list,locals,long,map,max,min,object,oct,open,ord,pow,property,%
quit,range,raw_input,reduce,reload,repr,reversed,round,set,setattr,%
slice,sorted,staticmethod,str,sum,super,tuple,type,unichr,unicode,%
vars,xrange,zip},
emphstyle=[4]\color{purple},
upquote=true,
morecomment=[s][\color{dgraycolor}]{"""}{"""},
commentstyle=\color{dgraycolor}\slshape,
%literate={>>>}{\textbf{\textcolor{darkred}{>{>}>}}}3%
literate={>>>}{\textbf{\textcolor{red}{>{>}>}}}3%
         {...}{{\textcolor{gray}{...}}}3,
procnamekeys={def,class},
procnamestyle=\color{dredcolor},
%framexleftmargin=1mm, framextopmargin=1mm, frame=shadowbox,
xleftmargin=\parindent,frame=shadowbox,
numbers=left,
numberstyle={\fontsize{5pt}{5pt}\ttfamily},
rulesepcolor=\color{dgraycolor},
mathescape=true
}
%}}}
\pdfpagewidth 8.5in
\pdfpageheight 11in

\@ifundefined{nopageformat}{
\pagestyle{fancy}
\fancyhf{}
\oddsidemargin -0.5in % add 1in to get margin
\evensidemargin -0.5in % add 1in to get margin
\voffset -0.5in
\topmargin 0in
%\textwidth 7.5in%decreased to make room for labels
\textwidth 7.0in
\textheight 9.25in
\headheight 15pt 
%\headheight 0in
\headsep 15pt
}{}
%\renewcommand{\sectionmark}[1]{\markright{#1}{}}
%\markright{\sectionmark{}}
\RequirePackage{amsmath}
\RequirePackage{hycolor}
% BEGIN part for commenting
\RequirePackage{makeidx}
\makeindex
\RequirePackage{verbatim}
\RequirePackage{graphicx}
\@ifundefined{supressmulticols}{
\RequirePackage{multicol}
}{}
\setcounter{tocdepth}{9}
\setcounter{secnumdepth}{6}
%\renewcommand\theparagraph{\roman{paragraph}}
\providecommand{\DIFadd}[1]{{\protect\color{blue}\uwave{#1}}} %DIF PREAMBLE
\providecommand{\DIFdel}[1]{{\protect\color{red}\xout{#1}}}                      %DIF PREAMBLE
\pdfstringdefDisableCommands{\renewcommand{\DIFdel}{}}
\pdfstringdefDisableCommands{\renewcommand{\DIFadd}{}}
\immediate\write18{bash\space datenow.sh\space datenow.out} % to save into the file
\newcommand{\Now}{\immediate\input datenow.out}
%{{{ filenames with fancy underscore escape
%\begingroup
%\gdef\tempunderscore{_}
%\catcode`_=\active
%\gdef\makeunderscoreliteral{
%    \catcode`_=\active
%    \def_{\textunderscore\-}
%}
%\gdef\changeunderscoreback{
%    \catcode`_=\active
%    \def_{\tempunderscore}
%}
%\endgroup
%\newcommand{\verblike}[1]{\makeunderscoreliteral#1\changeunderscoreback}
%\begingroup\catcode`_=\active
%\gdef\mysmallverb{%    note the global \gdef
%  \catcode`_=\active
%  \def_{blah}%
%}
%\endgroup

%\newcommand{\fn}[1]{{\color{red}
%\begingroup\catcode`_=13
%#1
%\endgroup
%}}
\begingroup
  \catcode`\_=\active
  \gdef_#1{\ensuremath{\sb{\mathrm{#1}}}}
\endgroup
%\mathcode`\_=\string"8000
\catcode`\_=12

%\def\fn{\begingroup\catcode`\_=12 \newfnx}
%\newcommand{\newfnx}[1]{\oldfn{#1}\endgroup}
%}}}
%{{{ example for comma separated list, taken from http://stackoverflow.com/questions/2402354/split-comma-separated-parameters-in-latex

% Functional foreach construct 
% #1 - Function to call on each comma-separated item in #3
% #2 - Parameter to pass to function in #1 as first parameter
% #3 - Comma-separated list of items to pass as second parameter to function #1
\def\foreach#1#2#3{%
  \@test@foreach{#1}{#2}#3,\@end@token%
}

% Internal helper function - Eats one input
\def\@swallow#1{}

% Internal helper function - Checks the next character after #1 and #2 and 
% continues loop iteration if \@end@token is not found 
\def\@test@foreach#1#2{%
  \@ifnextchar\@end@token%
    {\@swallow}%
    {\@foreach{#1}{#2}}%
}

% Internal helper function - Calls #1{#2}{#3} and recurses
% The magic of splitting the third parameter occurs in the pattern matching of the \def
\def\@foreach#1#2#3,#4\@end@token{%
  #1{#2}{#3}%
  \@test@foreach{#1}{#2}#4\@end@token%
}

%}}}

%\newenvironment{err}{\vspace{-4ex}\begin{quotation}\begin{footnotesize}\hspace{-0.5in}\begin{tiny}\textsc{(Debug:)}\end{tiny}\mysmallline
%    
%    \vspace{-0.5ex}}{
%    
%    \vspace{-2ex}\hspace{-0.5in}\myarbline{1.3in}\end{footnotesize}\end{quotation}\vspace{-1.5ex}}
\newenvironment{err}{\ \\ \textit{\footnotesize{\color{gray}Debug}}$\color{gray}\left\{\normalcolor\begin{minipage}{0.95\linewidth}\begin{footnotesize}}{\end{footnotesize}\end{minipage}\right.$}

\newcommand\mysmallline{\rule{1in}{0.01mm}}
\newcommand\myarbline[1]{\rule{#1}{0.01mm}}
\let\oldsection = \section
\let\oldsubsection = \subsection
%\renewcommand{\subsection}[1]{\oldsubsection{{\tiny #1}}}
\@ifundefined{noparagraph}{
\RequirePackage{myparagraphformatting}
}{
\RequirePackage[noparagraph]{myparagraphformatting}
}
\newcommand{\blacktext}[1]{\texorpdfstring{{\color{black}#1}}{#1}}
\renewcommand{\subsection}[1]{\oldsubsection{#1\condhrule}}
\renewcommand{\section}[2][]{\oldsection{#2\condhrule{\tiny #1}}}

\renewcommand{\o}[2][]{ {\color{mygreen}{\it #1}} {\color{blue} #2}}

\gdef\total{0}
\gdef\thistimeblock{0.001}
\gdef\obstimecounter{0}
\gdef\obstimecounterflag{0}
\gdef\mytempval{0}

\def\zeroPadTwo#1%
{% Left zero pad of the argument to 2 digits.  The argument
%  should be a number between 1 and 99.  This macro outputs
%  a `0' if the argument is less than ten, then it outputs
%  the argument.
%
  \ifnum #1<10 0\fi    % Conditionally output a zero
  #1%    Then output the argument
}% --- \zeroPadTwo ---

\newcommand{\myprinttime}[1]{\FPset\numhrs{#1}\FPtrunc\numhrs\numhrs{0}\FPset\nummins{0}\FPsub\nummins{#1}\numhrs\FPmul\nummins\nummins{60}\FPtrunc\nummins\nummins{0}\numhrs:\zeroPadTwo\nummins}

%{{{ finished time using tex optional arguments (allows colon/no colon)!
\newcommand{\finishedtime}{}%just to check
\DeclareRobustCommand\finishedtime{\@ifnextchar[{\@@finishedtime}{\@finishedtime}}
\def\@finishedtime#1{%
\FPmul\mytemp{#1}{60}%
\global\let\mytempval=\mytemp%
\o[\obstb\obstmINV{\mytempval}\obstd]{}%
}
\def\@@finishedtime[#1]#2{%
\FPmul\mytemp{#2}{60}%
\global\let\mytempval=\mytemp%
\o[#1: \obstb\obstmINV{\mytempval}\obstd]{}%
}

\DeclareRobustCommand\donetime{\@ifnextchar[{\@@donetime}{\@donetime}}
\def\@donetime#1{\finishedtime{#1}\maxtime{#1}}
\def\@@donetime[#1]#2{%
\finishedtime[#1]{#2}\maxtime{#2}%
}

\gdef\timeperday{8}

\newcommand{\maxtime}[1]{\FPset\tvar{#1}%
\FPadd\ttotal\tvar\total%
\global\let\total=\ttotal%
\FPdiv\poftotal\tvar\timeblocktotalval%
\FPmul\poftotal\poftotal{100}%
\FPdiv\numberdays\tvar{\timeperday}%
\FPtrunc\poftotal\poftotal{1}%
\FPtrunc\numberdays\numberdays{2}%
\global\let\thistimeblock=\tvar%
({\it \myprinttime\tvar, +\numberdays\ days, \poftotal\% of total})}

\def\IsPositive#1{%
  TT\fi%
  \ifcat_\ifnum0<#1 _\else A\fi%
}
\newcommand{\marktime}{
\FPsub\tvar\ttotal\dumpval%
\FPdiv\numbertotaldays\tvar{\timeperday}%
\FPtrunc\numbertotaldays\numbertotaldays{2}%
\FPtrunc\tvar\tvar{2}%
%http://en.wikibooks.org/wiki/LaTeX/Plain_TeX
\pgfmathparse{ifthenelse(\tvar>=0,"TT","FT")}% character codes match (true) or don't (false)
\if\pgfmathresult%(
\pgfmathparse{int(floor(\tvar))}%
\let\localresulthours = \pgfmathresult%
\pgfmathparse{int(round((\tvar-\localresulthours)*60))}%
\let\localresultminutes = \pgfmathresult
{{\it =\localresulthours:\zeroPadTwo\localresultminutes\ (\numbertotaldays\ days) to get here}}%
\else%)(
\FPmul\tvar{-1}\tvar%
{\color{red}{over:\maxtime{\tvar}}}%
\fi%)
}

\gdef\timeblocktotalval{9}

\newcommand{\maxtwenty}[1]{\FPset\tvar{#1}\FPdiv\tvar\tvar{3}\FPtrunc\tvar\tvar{2}\maxtime{\tvar}}
\newcommand{\maxminutes}[1]{\FPset\tvar{#1}\FPdiv\tvar\tvar{60}\FPtrunc\tvar\tvar{2}\maxtime{\tvar}}
\newcommand{\maxdays}[1]{#1 days \FPset\tvar{#1}\FPmul\tvar\tvar{\timeperday}\FPtrunc\tvar\tvar{2}\maxtime{\tvar}}

\newcommand\timeblocktotal[1]{{\it Time block total: \myprinttime{#1}}\gdef\timeblocktotalval{#1}}
\newcommand\timeblocktotaldays[1]{ {\it Time block total:%
\FPset\mytemp{#1}\FPmul\mytemp{\timeperday}\mytemp%
\global\let\mytempval=\mytemp%
\myprinttime{\mytempval}}\gdef\timeblocktotalval{\mytempval}}

\newcommand{\obstb}{\FPset\mytemp{0}\global\let\obstimecounter=\mytemp\FPset\mytemp{1}\global\let\obstimecounterflag=\mytemp}

\newcommand{\obsts}{\FPset\obstimecounterflagvar{\obstimecounterflag}\FPset\mytemp{0}\FPset\mynegone{-1}\FPmul\mytemp\obstimecounterflagvar\mynegone\global\let\obstimecounterflag=\mytemp}

\newcommand{\obsta}[1]{\obsts\FPset\obstimecountervar{\obstimecounter}\FPset\obstimecounterflagvar{\obstimecounterflag}\FPset\mytemp{#1}\FPset\myhr{3600}\FPmul\mytemp\obstimecounterflagvar\mytemp\FPdiv\mytemp\mytemp\myhr\FPadd\mytemp\obstimecountervar\mytemp\global\let\obstimecounter=\mytemp}

\newcommand{\obstm}[1]{\FPset\obstimecountervar{\obstimecounter}\FPset\obstimecounterflagvar{\obstimecounterflag}\FPset\mytemp{#1}\FPset\myhr{60}\FPmul\mytemp\obstimecounterflagvar\mytemp\FPtrunc\mytemp\mytemp{1}\mytemp min\FPdiv\mytemp\mytemp\myhr\FPadd\mytemp\obstimecountervar\mytemp\global\let\obstimecounter=\mytemp}
\newcommand{\obstmINV}[1]{%same as obstm, but invisible (doesn't print minutes)
\FPset\obstimecountervar{\obstimecounter}\FPset\obstimecounterflagvar{\obstimecounterflag}\FPset\mytemp{#1}\FPset\myhr{60}\FPmul\mytemp\obstimecounterflagvar\mytemp\FPtrunc\mytemp\mytemp{1}\FPdiv\mytemp\mytemp\myhr\FPadd\mytemp\obstimecountervar\mytemp\global\let\obstimecounter=\mytemp}

\newcommand{\obstd}{\FPset\mytemp\obstimecounter
\FPdiv\poftotal\mytemp\thistimeblock
\FPtrunc\mytemp\mytemp{2}
\FPmul\poftotal\poftotal{100}
\FPtrunc\poftotal\poftotal{1}
({\bf \myprinttime\mytemp, \poftotal\%})\FPadd\mytemp\mytemp\dumpval\global\let\dumpval=\mytemp}
\newcommand{\obstdump}{%
\FPset\mytemp\dumpval\FPtrunc\mytemp\mytemp{2}%
\o{({\bf \mytemp hr})}%
}

\newenvironment{tasklist}{\begin{tiny}
\FPset\ttotal{0}
\begin{multicols}{2}
\begin{itemize}
}{
\end{itemize}
\end{multicols}
\end{tiny}}

\newenvironment{hidden}[1]{}

\newenvironment{pcomments}{\begin{minipage}{4.5in}}{\end{minipage}}
\newcommand{\pstandard}[1]{\begin{minipage}{3in}\includegraphics[width=3in]{#1}\end{minipage}}
\newcommand{\timeblockstart}{\gdef\total{0}\gdef\dumpval{0}\FPset\ttotal{0}\dotfill}
\newcommand{\timeblockend}{\FPset\mytemp\total
\FPtrunc\mytemp\mytemp{1}
{\tiny{\it = \mytemp hr total}%
\FPset\mytemptwo\dumpval\FPtrunc\mytemptwo\mytemptwo{1}%
\o{-{\bf \mytemptwo hr = %
\FPsub\mytemp\mytemp\mytemptwo%
\FPtrunc\mytemp\mytemp{1}%
\mytemp hr left}
}%
}\dotfill}

\newenvironment{timeblock}[2]{%
\timeblockstart\gdef\timeperday{#1}\timeblocktotaldays{#2}%
}{%
\timeblockend
}

\newenvironment{tasks}{\timeblockstart\phantomsection\addcontentsline{toc}{subsubsection}{tasks}
\begin{small}
\begin{multicols}{2}
\gdef\timeblocktotalval{9}
}{
\end{multicols}
\timeblockend
\myline
\end{small}}

\newcommand{\breaklist}{\end{itemize}
\end{multicols}
\FPset\mytemp\total
\FPtrunc\mytemp\mytemp{1}
{\tiny{\it = \mytemp hr total}}
\myline
\begin{multicols}{2}
\begin{itemize}
}
\newcommand{\breako}[1]{
\o{\item #1}
\end{itemize}
\myline
\begin{itemize}
}
\newcommand{\tasko}[1]{
\o{#1}

\myline
}
\newcommand{\breakk}[1]{
\item #1
\end{itemize}
\myline
\begin{itemize}
}
\newcommand{\taskk}[1]{
#1
\myline
}

% Remember chapter title
%\renewcommand{\chaptermark}[1]{\markboth{Chap. \thechapter:\ #1}{}}
% section number and title
%\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}}
%\renewcommand{\sectionmark}[1]{\markright{\thesection\ }}
\lhead[\fancyplain{}{\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad R. Barnes Notebook p \thepage}] %
    {\fancyplain{}{\bfseries\rightmark}}
%\rhead[\fancyplain{}{\scshape Sec.\arabic{section}}] %
%    {\fancyplain{}{R. Barnes Notebook p \thepage}}
%\lhead{ \Roman{chapter}$\Rightarrow$\arabic{section}.\Alph{subsection} \leftmark}
%%%\lhead{ \Roman{chapter}$\Rightarrow$\arabic{section} \leftmark}
%%%%\lhead{\leftmark}
%%%\rhead[\fancyplain{}{}] %
%%%    {\fancyplain{}{ / R. Barnes Notebook, compiled \today}}
%%%\lfoot{p \thepage}
%%%%\rfoot{p \thepage}
%%%\renewcommand{\sectionmark}[1]{\markboth{#1}{#1}}
%
%% from http://www.kronto.org/thesis/tips/custom-headers.html
%\@ifundefined{chaptermark}{}{
%\renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{#1}}{}}
%}
%\renewcommand{\sectionmark}[1]{\markright{#1}{}}
%
%\@ifundefined{noheader}{
%\@ifundefined{thechapter}{}{
%\fancyhead[LO]{\thechapter.\thesection:}
%\fancyhead[RE]{\thechapter.\thesection}
%\fancyhead[RO]{{\footnotesize\rightmark}\hspace{2em}p{\bf\thepage}}
%\fancyhead[LE]{p{\bf\thepage}\hspace{2em}\footnotesize{\leftmark}}
%}
%}{}
%
%%\rhead{Notebook \today}
%%\chead{\sectionname}
%%\lhead{Ryan Barnes}
%%\rfoot{Right bottom}
%%\cfoot{\thepage}
%%\rfoot{\thepage}
%%\lfoot{Left bottom}
%
\@ifundefined{nolabels}{
\RequirePackage{mylabels}
}{}
%%\bibliographystyle{abbrvnat}
%%\RequirePackage[sort&compress]{natbib}
%%\bibliographystyle{unsrt}
\RequirePackage{fp}
\gdef\total{0}\gdef\dumpval{0}\FPset\ttotal{0} % initialize, whether or not I start the timeblock

\newcommand{\add}[1]{\textit{#1}}
\newcommand{\command}[1]{{\tt #1}}
\newcommand{\na}[1]{\begin{tiny}{\it{\color{mygray}#1}}\end{tiny}}
\newcommand{\refhyp}[1]{{\it hyp:}\ref{hyp:#1}}
\newcommand{\Cat}{Cat$_1$}
\newcommand{\mainhyp}[1]{{\bf #1}}
\newcommand{\rhosmax}{\ensuremath{\rho s_{max}}}
\newcommand{\subhyp}[2][]{{\it \textbf{#1} }{\it #2}}
%\def\thechapter{\Roman{chapter}}
%\def\thesection{\arabic{section}}
%\def\thesubsection{\Alph{subsection}}
%\def\thesubsubsection{\arabic{subsubsection}}
\newcommand{\notyet}[1]{{\color{red}#1}}
\newcommand{\needtocheck}[1]{{\color{yellow}#1}}
\newcommand{\putref}{\begin{tiny}[ref]\end{tiny}}
\newenvironment{DIFnomarkup}{}{}
\newcommand{\cwdnp}{cw-DNP}

\newcommand\precaution[1]{\begin{scriptsize}\textit{#1}\end{scriptsize}}
\newcommand\twooptions[2]{

\begin{tabular}{c|c}
    Option 1 & Option 2\\
\begin{minipage}{3.5in}
#1
\end{minipage}
&
\begin{minipage}{3.5in}
#2
\end{minipage}
\\
\end{tabular}

}

\newcommand\textsubscript[1]{\ensuremath{{}_{\text{#1}}}}
\let\myolditemi=\labelitemi
\let\myolditemii=\labelitemii
\RequirePackage{multirow}

% start date formatting
\RequirePackage{datetime}
\RequirePackage{datenumber}% Date formatting
\RequirePackage{pgf}% For math
\RequirePackage{xstring}% Needed for \IfStrEqCase and \IfEq 
\newcounter{randomstartdate}
\newcounter{mynewdate}
\newcounter{mytodaysdate}
\newcounter{numberofdaysago}
\newcounter{numberofdaysuntil}
\newcounter{numberofweeksuntil}
\newcounter{mytemporary}
\newdateformat{mydate}{\shortmonthname[\THEMONTH] \ordinaldate{\THEDAY}}
\newcommand{\formatdatenumber}{\mydate\formatdate{\the\value{dateday}}{\the\value{datemonth}}{\the\value{dateyear}}}
\newcommand{\saydate}[3]{%
    \setdatenumber{2010}{1}{1}%
    \setcounter{randomstartdate}{\value{datenumber}}% use to make numbers manageable%
    \setdatenumber{#1}{#2}{#3}%
    \setcounter{mynewdate}{\value{datenumber}}%
    \addtocounter{mynewdate}{-\value{randomstartdate}}%
    \setdatetoday % sets the counters back to today%
    \setcounter{mytodaysdate}{\value{datenumber}}%
    \addtocounter{mytodaysdate}{-\value{randomstartdate}}%
    \pgfmathsetcounter{numberofdaysuntil}{int(\value{mynewdate})-int(\value{mytodaysdate})}%
    \pgfmathsetcounter{numberofdaysago}{ifthenelse(int(\value{numberofdaysuntil})<0,int(-int(\value{numberofdaysuntil})),0)}%
    \pgfmathsetcounter{numberofdaysuntil}{ifthenelse(int(\value{numberofdaysuntil})<0,-1,int(\value{numberofdaysuntil}))}%
    \pgfmathsetcounter{numberofweeksuntil}{(int(\value{numberofdaysuntil}) + int(\value{datedayname}) - 1)/7}% give weeks until, but add an offset, so next monday is ``next'' monday, not ``this'' monday -- monday starts the week%
    \addtocounter{mynewdate}{\value{randomstartdate}}%
    \addtocounter{mytodaysdate}{\value{randomstartdate}}%
    \setdatebynumber{\value{mynewdate}}%
    \setcounter{mytemporary}{\value{numberofdaysago}}%don't know why I need to do this, but apparently I do
    \IfEq{\the\value{numberofdaysuntil}}{-1}{\textbf{already!!} %
            \IfEq{\the\value{mytemporary}}{1}{(yesterday)}{%
                (\the\value{mytemporary} days ago)%
            }%
        }{%
        \IfEq{\the\value{numberofdaysuntil}}{0}{\textbf{today}}{%
            \IfEq{\the\value{numberofdaysuntil}}{1}{\textbf{tomorrow}}{%
                \IfEq{\the\value{numberofweeksuntil}}{0}{\datedayname, this week (\formatdatenumber)}{%
                    \IfEq{\the\value{numberofweeksuntil}}{1}{\datedayname, next week (\formatdatenumber)}{%
                        later: \formatdatenumber%
                    }%
                }%
            }%
        }%
    }%
    \setdatetoday%
}%
\newcommand{\detcolor}[3]{%
    \setdatenumber{2010}{1}{1}%
    \setcounter{randomstartdate}{\value{datenumber}}% use to make numbers manageable%
    \setdatenumber{#1}{#2}{#3}%
    \setcounter{mynewdate}{\value{datenumber}}%
    \addtocounter{mynewdate}{-\value{randomstartdate}}%
    \setdatetoday % sets the counters back to today%
    \setcounter{mytodaysdate}{\value{datenumber}}%
    \addtocounter{mytodaysdate}{-\value{randomstartdate}}%
    \pgfmathsetcounter{numberofdaysuntil}{int(\value{mynewdate})-int(\value{mytodaysdate})}%
    \pgfmathsetcounter{numberofdaysago}{ifthenelse(int(\value{numberofdaysuntil})<0,int(-int(\value{numberofdaysuntil})),0)}%
    \pgfmathsetcounter{numberofdaysuntil}{ifthenelse(int(\value{numberofdaysuntil})<0,-1,int(\value{numberofdaysuntil}))}%
    \pgfmathsetcounter{numberofweeksuntil}{(int(\value{numberofdaysuntil}) + int(\value{datedayname}) - 1)/7}% give weeks until, but add an offset, so next monday is ``next'' monday, not ``this'' monday -- monday starts the week%
    \pgfmathparse{ifthenelse(int(\value{numberofdaysuntil}) < 1,"white",%
        ifthenelse(int(\value{numberofdaysuntil}) < 4,"red",%
            ifthenelse(int(\value{numberofdaysuntil}) < 7,"dredcolor",%
                "dgreencolor")))}\color{\pgfmathresult}%
    \pgfmathparse{ifthenelse(int(\value{numberofdaysuntil}) < 1,"dredcolor","white")%
        }\def\myboxcolor{\pgfmathresult}%
    \setdatetoday%
    %
}%
\newcommand\due[4][]{{\detcolor{#2}{#3}{#4}\colorbox{\myboxcolor}{Due:\,\saydate{#2}{#3}{#4} {\detcolor{#2}{#3}{#4}#1}}}}

\makeatletter\newenvironment{inplacenotebox}{%

\def\myboxwidth{\linewidth-0.5in}\begin{lrbox}{\@tempboxa}\begin{minipage}{\myboxwidth}\textbf{\color{darkgreen}Note:}\begin{scriptsize}}{\end{scriptsize}\end{minipage}\end{lrbox}%
       \colorbox{lightgreen}{\usebox{\@tempboxa}}
\quad\\ 
}\makeatother
% end date formatting
